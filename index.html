<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vitals Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1f2937;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    h2 {
      margin-top: 0;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 140px;
    }
    label {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    input, select, button {
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
      background: #2563eb;
      color: white;
      border: none;
      transition: background 0.2s;
    }
    button:hover {
      background: #1d4ed8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f9fafb;
    }
    .actions button {
      margin: 0 2px;
      background: #6b7280;
    }
    .actions button:hover {
      background: #4b5563;
    }
    .filter-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Vitals Tracker</h1>
  </header>

  <div class="container">
    <!-- Input Form -->
    <div class="card">
      <h2>Add / Edit Vitals</h2>
      <form id="vitals-form">
        <div class="row">
          <div class="input-group">
            <label for="person">Person</label>
            <select id="person" required>
              <option value="">Select</option>
              <option value="Mom">Mom</option>
              <option value="Dad">Dad</option>
            </select>
          </div>
          <div class="input-group">
            <label for="systolic">Systolic</label>
            <input type="number" id="systolic" required>
          </div>
          <div class="input-group">
            <label for="diastolic">Diastolic</label>
            <input type="number" id="diastolic" required>
          </div>
          <div class="input-group">
            <label for="pulse">Pulse</label>
            <input type="number" id="pulse" required>
          </div>
          <div class="input-group">
            <label for="oxygen">Oxygen %</label>
            <input type="number" id="oxygen" required>
          </div>
          <div class="input-group">
            <label for="timestamp-input">Date & Time</label>
            <input type="datetime-local" id="timestamp-input" required>
          </div>
        </div>
        <div class="row">
          <button type="submit" id="submit-btn">Add Vitals</button>
          <button type="button" id="update-btn" style="display:none;">Update</button>
          <button type="button" id="cancel-edit-btn" style="display:none;background:#6b7280;">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Filters -->
    <div class="card">
      <h2>Recent Readings</h2>
      <div class="row">
        <div class="input-group">
          <label for="date-range-start">Start Date</label>
          <input type="date" id="date-range-start">
        </div>
        <div class="input-group">
          <label for="date-range-end">End Date</label>
          <input type="date" id="date-range-end">
        </div>
      </div>
      <div class="filter-buttons">
        <button id="apply-filter-btn">Apply Filter</button>
        <button id="show-all-btn">Show All Records</button>
        <button id="show-current-btn">Show Current Month</button>
        <button id="download-pdf-btn">Download PDF</button>
      </div>
      <table id="vitals-table">
        <thead>
          <tr>
            <th>Person</th>
            <th>Systolic</th>
            <th>Diastolic</th>
            <th>Pulse</th>
            <th>Oxygen</th>
            <th>Date & Time</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    let records = JSON.parse(localStorage.getItem("vitalsRecords")) || [];
    let editingIndex = null;

    function saveRecords() {
      localStorage.setItem("vitalsRecords", JSON.stringify(records));
    }

    function renderTable(data = records) {
      const tbody = document.querySelector("#vitals-table tbody");
      tbody.innerHTML = "";
      data.forEach((rec, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${rec.person}</td>
          <td>${rec.systolic}</td>
          <td>${rec.diastolic}</td>
          <td>${rec.pulse}</td>
          <td>${rec.oxygen}</td>
          <td>${new Date(rec.timestamp).toLocaleString()}</td>
          <td class="actions">
            <button onclick="editRecord(${index})">Edit</button>
            <button onclick="deleteRecord(${index})">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function addRecord(e) {
      e.preventDefault();
      const person = document.getElementById("person").value;
      const systolic = document.getElementById("systolic").value;
      const diastolic = document.getElementById("diastolic").value;
      const pulse = document.getElementById("pulse").value;
      const oxygen = document.getElementById("oxygen").value;
      const timestamp = document.getElementById("timestamp-input").value;

      const record = { person, systolic, diastolic, pulse, oxygen, timestamp };

      if (editingIndex === null) {
        records.push(record);
      } else {
        records[editingIndex] = record;
        editingIndex = null;
        document.getElementById("submit-btn").style.display = "inline-block";
        document.getElementById("update-btn").style.display = "none";
        document.getElementById("cancel-edit-btn").style.display = "none";
      }

      saveRecords();
      renderTable();
      document.getElementById("vitals-form").reset();
    }

    function editRecord(index) {
      const rec = records[index];
      document.getElementById("person").value = rec.person;
      document.getElementById("systolic").value = rec.systolic;
      document.getElementById("diastolic").value = rec.diastolic;
      document.getElementById("pulse").value = rec.pulse;
      document.getElementById("oxygen").value = rec.oxygen;
      document.getElementById("timestamp-input").value = rec.timestamp;
      editingIndex = index;
      document.getElementById("submit-btn").style.display = "none";
      document.getElementById("update-btn").style.display = "inline-block";
      document.getElementById("cancel-edit-btn").style.display = "inline-block";
    }

    function deleteRecord(index) {
      records.splice(index, 1);
      saveRecords();
      renderTable();
    }

    document.getElementById("vitals-form").addEventListener("submit", addRecord);

    document.getElementById("cancel-edit-btn").addEventListener("click", () => {
      editingIndex = null;
      document.getElementById("vitals-form").reset();
      document.getElementById("submit-btn").style.display = "inline-block";
      document.getElementById("update-btn").style.display = "none";
      document.getElementById("cancel-edit-btn").style.display = "none";
    });

    function applyFilter() {
      const start = document.getElementById("date-range-start").value;
      const end = document.getElementById("date-range-end").value;

      let filtered = records;

      if (start) {
        filtered = filtered.filter(r => new Date(r.timestamp) >= new Date(start));
      }
      if (end) {
        const endDate = new Date(end);
        endDate.setDate(endDate.getDate() + 1); // include entire day
        filtered = filtered.filter(r => new Date(r.timestamp) < endDate);
      }

      renderTable(filtered);
    }

    document.getElementById("apply-filter-btn").addEventListener("click", applyFilter);

    document.getElementById("show-all-btn").addEventListener("click", () => {
      document.getElementById("date-range-start").value = "";
      document.getElementById("date-range-end").value = "";
      renderTable();
    });

    document.getElementById("show-current-btn").addEventListener("click", () => {
      const now = new Date();
      const start = new Date(now.getFullYear(), now.getMonth(), 1);
      const end = new Date(now.getFullYear(), now.getMonth() + 1, 1);

      const filtered = records.filter(r => {
        const t = new Date(r.timestamp);
        return t >= start && t < end;
      });

      renderTable(filtered);
    });

    document.getElementById("download-pdf-btn").addEventListener("click", () => {
      const win = window.open("", "PDF", "width=800,height=600");
      win.document.write("<h1>Vitals Report</h1>");
      win.document.write(document.getElementById("vitals-table").outerHTML);
      win.document.close();
      win.print();
    });

    renderTable();
  </script>
</body>
</html>
